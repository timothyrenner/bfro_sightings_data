schema: '2.0'
stages:
  save-existing-reports:
    cmd:
    - touch data/raw/bfro_reports.json
    - cp data/raw/bfro_reports.json data/raw/bfro_reports_orig.json
    outs:
    - path: data/raw/bfro_reports_orig.json
      md5: aafa32b8e476c47c1302e30b65334d81
      size: 14473087
  pull-new-reports:
    cmd:
    - cd bfro/bfro_scrape && scrapy crawl bfro_reports --output $(dvc root)/data/raw/bfro_reports_new.json
      --output-format jsonlines
    outs:
    - path: data/raw/bfro_reports_new.json
      md5: 923e993e824f38ba0b39d55876a88aef
      size: 14459833
  merge-reports:
    cmd:
    - python bfro/bfro_union_reports.py data/raw/bfro_reports_orig.json data/raw/bfro_reports_new.json
      data/raw/bfro_reports.json
    deps:
    - path: bfro/bfro_union_reports.py
      md5: 2a0fa2b1d4608b9b59c139f0e9a594da
      size: 1132
    - path: data/raw/bfro_reports_new.json
      md5: 923e993e824f38ba0b39d55876a88aef
      size: 14459833
    - path: data/raw/bfro_reports_orig.json
      md5: aafa32b8e476c47c1302e30b65334d81
      size: 14473087
    outs:
    - path: data/raw/bfro_reports.json
      md5: b08560eb4a0f0dd695372b2513a04fc9
      size: 14474654
  extract-locations-from-kml:
    cmd:
    - python bfro/bfro_locations.py data/raw/doc.kml data/raw/bfro_locations.csv
    deps:
    - path: bfro/bfro_locations.py
      md5: 1bccec91de01012125fe742429d34f6f
      size: 2884
    - path: data/raw/doc.kml
      md5: 008ac1c7db316124e71ade3e50d5f6cd
      size: 6575789
    outs:
    - path: data/raw/bfro_locations.csv
      md5: 49b572c8c6c10d1bab1b85abb758d68d
      size: 582862
  geocode-reports:
    cmd:
    - python bfro/bfro_report_join.py data/raw/bfro_locations.csv data/raw/bfro_reports.json
      data/interim/bfro_reports_geocoded.csv
    deps:
    - path: bfro/bfro_report_join.py
      md5: 3ee9ba5780176eac46f9ef8d8b09c4ec
      size: 3492
    - path: data/raw/bfro_locations.csv
      md5: 49b572c8c6c10d1bab1b85abb758d68d
      size: 582862
    - path: data/raw/bfro_reports.json
      md5: b08560eb4a0f0dd695372b2513a04fc9
      size: 14474654
    outs:
    - path: data/interim/bfro_reports_geocoded.csv
      md5: 8b26fd2cd9472c6810edd76f3508a32a
      size: 10997393
  pull-weather:
    cmd:
    - python bfro/bfro_report_weather.py data/interim/bfro_reports_geocoded.csv data/cache/weather_cache.csv
    deps:
    - path: bfro/bfro_report_weather.py
      md5: d5a1920e6485793500aea3974ab62380
      size: 2693
    - path: data/interim/bfro_reports_geocoded.csv
      md5: 8b26fd2cd9472c6810edd76f3508a32a
      size: 10997393
    outs:
    - path: data/cache/weather_cache.csv
      md5: c15de63d58894cb4ffb5b6cb324f5e82
      size: 8008082
  add-weather:
    cmd:
    - python bfro/bfro_weather_join.py data/interim/bfro_reports_geocoded.csv data/cache/weather_cache.csv
      data/processed/bfro_reports_geocoded.csv
    deps:
    - path: bfro/bfro_weather_join.py
      md5: 2e4c590098cdc95a990a46c771557a03
      size: 2397
    - path: data/cache/weather_cache.csv
      md5: c15de63d58894cb4ffb5b6cb324f5e82
      size: 8008082
    - path: data/interim/bfro_reports_geocoded.csv
      md5: 8b26fd2cd9472c6810edd76f3508a32a
      size: 10997393
    outs:
    - path: data/processed/bfro_reports_geocoded.csv
      md5: bd0e2517fdfc142d886532c87b3ed63d
      size: 11529076
  pull-kml:
    cmd:
    - wget http://www.bfro.net/app/AllReportsKMZ.aspx
    - mv AllReportsKMZ.aspx data/raw/
    - unzip -o data/raw/AllReportsKMZ.aspx -d data/raw/
    outs:
    - path: data/raw/AllReportsKMZ.aspx
      md5: 517658b09386548383154a5a01ac5f04
      size: 526448
    - path: data/raw/doc.kml
      md5: 008ac1c7db316124e71ade3e50d5f6cd
      size: 6575789
